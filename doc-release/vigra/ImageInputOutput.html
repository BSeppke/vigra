<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><TITLE>vigra - Image Input Output</TITLE>
<link rel=stylesheet type="text/css" href="vigra.css">
<link rel="shortcut icon" href="vigra-icon.ico" />
</head>
<body  bgcolor="#f8f0e0" link="#0040b0" vlink="#a00040">
<basefont face="Helvetica,Arial,sans-serif" size=3>
<p align=right>
[ <a href="http://hci.iwr.uni-heidelberg.de/vigra/">VIGRA Homepage</a> |
 <a href="functionindex.html">Function Index</a> |
 <a href="classes.html">Class Index</a> |
 <a href="namespaces.html">Namespaces</a> |
 <a href="files.html">File List</a> |
 <a href="index.html">Main Page</a> ]
</p>
<!-- Generated by Doxygen 1.7.6.1 -->
</div>
<div class="contents">
<table class="main_heading">
<tr>
<td width="100%">Image Input Output 
</td>
<td align=right><a href="http://hci.iwr.uni-heidelberg.de/vigra/"><IMG border=0 ALT="VIGRA" SRC="documents/vigra.gif" title="VIGRA Homepage"></a></td></tr>
</table><p>

<div class="textblock"><p>In this chapter we'd like to show you how to import and export an image with Vigra. If you you want to import an image from disk and enquire about its properties, you must use an object of <code> ImageImportInfo </code> class. It reads the header of the image file. The constructor expects the file name, the file type will be determined automatically. The following types are recognized:</p>
<dl>
<dt>"BMP"</dt>
<dd>Microsoft Windows bitmap image file. </dd>
<dt>"EXR"</dt>
<dd>OpenEXR high dynamic range image format. (only available if libopenexr is installed) </dd>
<dt>"GIF"</dt>
<dd>CompuServe graphics interchange format; 8-bit color. </dd>
<dt>"HDR"</dt>
<dd>Radiance RGBE high dynamic range image format. </dd>
<dt>"JPEG"</dt>
<dd>Joint Photographic Experts Group JFIF format; compressed 24-bit color (only available if libjpeg is installed). </dd>
<dt>"PNG"</dt>
<dd>Portable Network Graphic (only available if libpng is installed). </dd>
<dt>"PBM"</dt>
<dd>Portable bitmap format (black and white). </dd>
<dt>"PGM"</dt>
<dd>Portable graymap format (gray scale). </dd>
<dt>"PNM"</dt>
<dd>Portable anymap. </dd>
<dt>"PPM"</dt>
<dd>Portable pixmap format (color). </dd>
<dt>"SUN"</dt>
<dd>SUN Rasterfile. </dd>
<dt>"TIFF"</dt>
<dd>Tagged Image File Format. (only available if libtiff is installed.) </dd>
<dt>"VIFF"</dt>
<dd>Khoros Visualization image file. </dd>
</dl>
<p>In the following example, the image is given via console as first argument:</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;iostream&gt;</span>
<span class="preprocessor">#include &quot;<a class="code" href="impex_8hxx.html" title="image import and export functions">vigra/impex.hxx</a>&quot;</span>

<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> ** argv) {
    
    <span class="comment">// read image given as first argument</span>
    <a class="code" href="classvigra_1_1ImageImportInfo.html" title="Argument object for the function importImage().">vigra::ImageImportInfo</a> imageInfo(argv[1]);

    <span class="comment">// Print some information:</span>
    std::cout &lt;&lt; <span class="stringliteral">&quot;Image information:\n&quot;</span>;
    std::cout &lt;&lt; <span class="stringliteral">&quot;Filetype: &quot;</span> &lt;&lt; imageInfo.getFileType() &lt;&lt; std::endl;
    std::cout &lt;&lt; <span class="stringliteral">&quot;Width: &quot;</span> &lt;&lt; imageInfo.width() &lt;&lt; std::endl;
    std::cout &lt;&lt; <span class="stringliteral">&quot;Height: &quot;</span> &lt;&lt; imageInfo.height() &lt;&lt; std::endl;
    std::cout &lt;&lt; <span class="stringliteral">&quot;Color Image: &quot;</span>;
    <span class="keywordflow">if</span> (imageInfo.isColor())    std::cout &lt;&lt; <span class="stringliteral">&quot;yes\n&quot;</span>;
    <span class="keywordflow">else</span>                        std::cout &lt;&lt; <span class="stringliteral">&quot;no\n&quot;</span>;

    <span class="keywordflow">return</span> 0;
}
</pre></div><p>As you can see, the <code> ImageImportInfo </code> object contains a lot of information, some of it is printed in the example. Using this image</p>
<div class="image">
<img src="lenna_small.gif" alt="lenna_small.gif"/>
<div class="caption">
input file</div></div>
<p> we get the following output:</p>
<div class="fragment"><pre class="fragment">
    Image information:
    Filetype: GIF
    Width: 154
    Height: 145
    Color Image: no
    </pre></div><p>To process images, this isn't enough. As described in <a class="el" href="Basics.html">Basic ideas</a> we want to save the image data in a multidimensional array. That's why we need <code> MultiArray </code> object and a method writing the image data into the array. This method is called <code> importImage(...) </code>. It needs an <code> ImageImportInfo </code> object and an <code>ImageIterator</code> (+ Accessor). To give the iterator, just use <code>destImage(imageArray)</code> where imageArray is the MultiArray object to copy the image data in. The code looks like this:</p>
 <div class="fragment"><pre class="fragment">    <span class="comment">// read image given as first argument</span>
    <a class="code" href="classvigra_1_1ImageImportInfo.html" title="Argument object for the function importImage().">vigra::ImageImportInfo</a> imageInfo(argv[1]);

    <span class="comment">// instantiate array for image data</span>
    <a class="code" href="classvigra_1_1MultiArray.html" title="Main MultiArray class containing the memory management.">vigra::MultiArray&lt;2, unsigned char&gt;</a> imageArray(imageInfo.shape());

    <span class="comment">// copy image data into array</span>
    importImage(imageInfo, destImage(imageArray));
</pre></div></p>
<p>Now, imageArray contains the image data and you can edit it. Writing the image data from an Array to a file is quite similar. For this purpose, we use the method <code>exportImage(...)</code>. It needs two iterators, one pointing at the upper-left point of an image, one at the lower-right, an Image Accessor and a <code><a class="el" href="classvigra_1_1ImageExportInfo.html" title="Argument object for the function exportImage().">vigra::ImageExportInfo</a></code>-object. To make it easier, just use the <code>srcImageRange(imageArray)</code> method instead of giving two iterators and an accessor. The ImageExportInfo-object needs a file name. The file-type is guessed from the file name's extension. Recognized extensions are: '.bmp', '.exr', '.gif', '.jpeg', '.jpg', '.p7', '.png', '.pbm', '.pgm', '.pnm', '.ppm', '.ras', '.tif', '.tiff', '.xv', '.hdr'. EXR support requires libopenexr, JPEG support requires libjpeg, PNG support requires libpng and TIFF support requires libtiff. In the following example, we create and save a 160x160pixels - image, where the image is a chess board. The image is saved as "testimage.gif" in the same folder as the executed code.</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;iostream&gt;</span>
<span class="preprocessor">#include &lt;vigra/multi_array.hxx&gt;</span>
<span class="preprocessor">#include &lt;vigra/stdimage.hxx&gt;</span>
<span class="preprocessor">#include &quot;<a class="code" href="impex_8hxx.html" title="image import and export functions">vigra/impex.hxx</a>&quot;</span>

<span class="keyword">using namespace </span>vigra; 


<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> ** argv) {
    
    <span class="comment">// instantiate array for image data of size 160x160 pixels</span>
    vigra:<a class="code" href="classvigra_1_1MultiArray.html" title="Main MultiArray class containing the memory management.">MultiArray&lt;2, unsigned char&gt;</a> imageArray(<a class="code" href="group__MultiIteratorGroup.html#ga2e2ffc107bb0e38f9b1288b647c8ec5b" title="shape type for MultiArray&lt;2, T&gt;">Shape2</a>(160,160));

    <span class="comment">// set the pixels to black (0) or white (255)</span>
        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; imageArray.<a class="code" href="classvigra_1_1MultiArrayView.html#a14c1df938ca1578ffc71bc9728b4e401">size</a>(0); i++) {
        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; imageArray.<a class="code" href="classvigra_1_1MultiArrayView.html#a14c1df938ca1578ffc71bc9728b4e401">size</a>(1); j++) {

        <span class="keywordflow">if</span> ((i%20)/10 == (j%20)/10) imageArray[<a class="code" href="group__MultiIteratorGroup.html#ga2e2ffc107bb0e38f9b1288b647c8ec5b" title="shape type for MultiArray&lt;2, T&gt;">Shape2</a>(i,j)] = 0;
        <span class="keywordflow">else</span>                        imageArray[<a class="code" href="group__MultiIteratorGroup.html#ga2e2ffc107bb0e38f9b1288b647c8ec5b" title="shape type for MultiArray&lt;2, T&gt;">Shape2</a>(i,j)] = 255; 
        }
    }

    <span class="comment">// write Image data to &quot;testimage.gif&quot;</span>
    <a class="code" href="group__VigraImpex.html#gabd7976d498abce467cd17989176133e3" title="Write an image given a vigra::ImageExportInfo object.">exportImage</a>(srcImageRange(imageArray), <a class="code" href="classvigra_1_1ImageExportInfo.html" title="Argument object for the function exportImage().">vigra::ImageExportInfo</a>(<span class="stringliteral">&quot;testimage.gif&quot;</span>));

    <span class="keywordflow">return</span> 0;
}
</pre></div><p>The resulting image is the following:</p>
<div class="image">
<img src="testimage.gif" alt="testimage.gif"/>
<div class="caption">
testimage.gif</div></div>
<p> Finally we want to give a whole example of importing, editing and exporting an image. After importing, we set every second horizontal line to black. This can be easily done with the <code>bind&lt;M&gt;(i)&gt;</code>-method thoroughly explained in <a class="el" href="ImportantMethods.html">Important Methods</a> . The input file and the output file are given as arguments via console.</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;iostream&gt;</span>
<span class="preprocessor">#include &lt;vigra/multi_array.hxx&gt;</span>
<span class="preprocessor">#include &lt;vigra/stdimage.hxx&gt;</span>
<span class="preprocessor">#include &quot;<a class="code" href="impex_8hxx.html" title="image import and export functions">vigra/impex.hxx</a>&quot;</span>

<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> ** argv) {
    
    <span class="comment">// read image given as first argument</span>
    <a class="code" href="classvigra_1_1ImageImportInfo.html" title="Argument object for the function importImage().">vigra::ImageImportInfo</a> imageInfo(argv[1]);

    <span class="comment">// instantiate array for image data</span>
    <a class="code" href="classvigra_1_1MultiArray.html" title="Main MultiArray class containing the memory management.">vigra::MultiArray&lt;2, unsigned char&gt;</a> imageArray(imageInfo.shape());

    <span class="comment">// copy image data into array</span>
    importImage(imageInfo, destImage(imageArray));

    <span class="comment">// set every second horizontal line to black</span>
    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i&lt;imageInfo.height(); i+=2) {
        imageArray.<a class="code" href="classvigra_1_1MultiArrayView.html#a5620a71abd33556ab702350b31b123da">bind</a>&lt;1&gt;(i)=0;
    }

    <span class="comment">// write image data to the file given as second argument</span>
    exportImage(srcImageRange(imageArray), <a class="code" href="classvigra_1_1ImageExportInfo.html" title="Argument object for the function exportImage().">vigra::ImageExportInfo</a>(argv[2]));

    <span class="keywordflow">return</span> 0;
}
</pre></div><p>The input image and the resulting output image are:</p>
<table  cellspacing="10">
<tr valign="bottom">
<td><div class="image">
<img src="lenna_small.gif" alt="lenna_small.gif"/>
<div class="caption">
input image</div></div>
  </td><td><div class="image">
<img src="lenna_stripes.gif" alt="lenna_stripes.gif"/>
<div class="caption">
output image</div></div>
   </td></tr>
</table>
<p><b>Note:</b> The handling of color images is exactly the same, but instead of instantiating a <code>vigra::MultiArray&lt;2, unsigned char&gt;</code> you need a <code> <a class="el" href="classvigra_1_1MultiArray.html" title="Main MultiArray class containing the memory management.">vigra::MultiArray</a>&lt;2, vigra::RGBValue&lt;unsigned char&gt; &gt; </code> array as described in <a class="el" href="Basics.html">Basic ideas</a> .</p>
<h2>For advanced users: </h2>
<p>The ImageExportInfo class provides some additional useful methods for instance <code> setCompression(...) </code>, which you can use for setting the image's compression type and quality.</p>
<p>Image Processing often requires more complicated calculations as seen in these examples. In this case, it is better to import and convert the data into a <code>float</code>-array instead of the <code>unsigned</code> type to avoid huge rounding errors. Conversion is automatically done by the importImage method. Of course, there are other possible types, but float is highly recommended for Image Processing.</p>
<p>Exporting a float-Array is handled differently. Some file formats allow float e.g. TIFF, so there is no conversion. If not, exportImage automatically converts the data into unsigned char. To see which types are allowed by each format look at the documentation of <a class="el" href="classvigra_1_1ImageExportInfo.html">vigra::ImageExportInfo</a> .</p>
<h3>HDF5-format </h3>
<p>HDF5 is a format to store multidimensional arrays. With VIGRA it is possible to import and export files in this format. See <a class="el" href="group__VigraHDF5Impex.html">Import/Export of Images and Arrays in HDF5 Format</a> for more information. </p>
</div></div><!-- contents -->
<!-- footer.html -->
<p>
<table border=0 cellspacing=0 width="100%"  bgcolor="#e0d0a0" cellpadding=5>
<tr>
<td>
<p>
<i>&copy; <A HREF="http://hci.iwr.uni-heidelberg.de/people/ukoethe/">Ullrich K&ouml;the</A>     (<A
HREF="mailto:ullrich.koethe@iwr.uni-heidelberg.de">ullrich.koethe@iwr.uni-heidelberg.de</A>)</i> <br>
<i><A HREF="http://hci.iwr.uni-heidelberg.de/">
Heidelberg Collaboratory for Image Processing</a>,
University of Heidelberg, Germany</i>
<td>
<p align=right>
<I>html generated using <A HREF="http://www.doxygen.org">doxygen</A> and <A HREF="http://www.python.org">Python</A></I>
<br>
<i>
vigra 1.9.0 (Tue Apr 23 2013)
</i>
</tr>
</table>


</BODY>
</HTML>
